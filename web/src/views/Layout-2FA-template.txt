<!-- Replace the Account Settings Modal section in Layout.vue with this: -->
<!-- Account Settings Modal -->
<n-modal v-model:show="showAccountModal" preset="dialog" title="账户设置" style="width: 600px;">
  <n-tabs type="line" animated>
    <n-tab-pane name="profile" tab="个人信息">
      <n-form :model="profileForm" label-placement="left" label-width="100">
        <n-form-item label="用户名">
          <n-input :value="userStore.user?.username" disabled />
        </n-form-item>
        <n-form-item label="邮箱">
          <n-input v-model:value="profileForm.email" placeholder="user@example.com" />
        </n-form-item>
      </n-form>
      <div style="margin-top: 16px; text-align: right;">
        <n-space>
          <n-button @click="showAccountModal = false">取消</n-button>
          <n-button type="primary" :loading="savingProfile" @click="handleSaveProfile">保存</n-button>
        </n-space>
      </div>
    </n-tab-pane>

    <n-tab-pane name="2fa" tab="双因素认证">
      <div v-if="!twoFactorEnabled">
        <n-alert type="info" title="未启用 2FA" style="margin-bottom: 16px;">
          启用双因素认证可以提高账户安全性。
        </n-alert>
        <n-button type="primary" @click="start2FASetup" :loading="loading2FA">启用 2FA</n-button>
      </div>

      <div v-else>
        <n-alert type="success" title="已启用 2FA" style="margin-bottom: 16px;">
          您的账户已受到双因素认证保护。
        </n-alert>
        <n-button type="warning" @click="show2FADisableModal = true">禁用 2FA</n-button>
      </div>
    </n-tab-pane>
  </n-tabs>
</n-modal>

<!-- 2FA Setup Modal -->
<n-modal v-model:show="show2FASetupModal" preset="dialog" title="启用双因素认证" style="width: 500px;">
  <div v-if="!twoFactorVerified">
    <n-space vertical>
      <div style="text-align: center;">
        <p>1. 使用验证器 App 扫描二维码</p>
        <p style="font-size: 12px; color: #999;">推荐: Google Authenticator, Microsoft Authenticator</p>
        <img v-if="qrCode" :src="qrCode" style="max-width: 200px; margin: 16px 0;" />
      </div>
      <div style="text-align: center;">
        <p>或手动输入密钥:</p>
        <n-input :value="twoFactorSecret" readonly type="textarea" :autosize="{ minRows: 2, maxRows: 3 }" />
      </div>
      <div>
        <p>2. 输入验证器生成的 6 位数字验证码:</p>
        <n-input v-model:value="verifyCode" placeholder="000000" maxlength="6" />
      </div>
    </n-space>
  </div>
  <div v-else>
    <n-alert type="success" title="2FA 已启用" style="margin-bottom: 16px;">
      请妥善保存以下备份码，每个备份码只能使用一次。
    </n-alert>
    <n-space vertical>
      <div v-for="(code, idx) in backupCodes" :key="idx" style="font-family: monospace; padding: 4px 8px; background: #f5f5f5; border-radius: 4px;">
        {{ code }}
      </div>
    </n-space>
  </div>
  <template #action>
    <n-space v-if="!twoFactorVerified">
      <n-button @click="cancel2FASetup">取消</n-button>
      <n-button type="primary" :loading="loading2FA" @click="verify2FACode">验证并启用</n-button>
    </n-space>
    <n-space v-else>
      <n-button type="primary" @click="finish2FASetup">完成</n-button>
    </n-space>
  </template>
</n-modal>

<!-- 2FA Disable Modal -->
<n-modal v-model:show="show2FADisableModal" preset="dialog" title="禁用双因素认证">
  <n-alert type="warning" title="警告" style="margin-bottom: 16px;">
    禁用 2FA 将降低您的账户安全性。
  </n-alert>
  <n-form>
    <n-form-item label="当前密码">
      <n-input v-model:value="disable2FAPassword" type="password" placeholder="请输入当前密码以确认" />
    </n-form-item>
  </n-form>
  <template #action>
    <n-space>
      <n-button @click="show2FADisableModal = false">取消</n-button>
      <n-button type="warning" :loading="loading2FA" @click="confirmDisable2FA">确认禁用</n-button>
    </n-space>
  </template>
</n-modal>
